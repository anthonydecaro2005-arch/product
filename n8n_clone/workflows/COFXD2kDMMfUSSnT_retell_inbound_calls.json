{
  "createdAt": "2025-09-22T16:23:27.761Z",
  "updatedAt": "2025-10-04T15:20:50.381Z",
  "id": "COFXD2kDMMfUSSnT",
  "name": "retell_inbound_calls",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.retellai.com/v2/register-phone-call",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $json.retell_api }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"agent_id\": \"{{ $json.agent_id }}\",\n  \"audio_websocket_protocol\": \"twilio\",\n  \"audio_encoding\": \"mulaw\",\n  \"sample_rate\": 8000,\n  \"from_number\": \"{{ $('Twilio Incoming1').item.json.body.From }}\",\n  \"to_number\": \"{{ $('Twilio Incoming1').item.json.body.To }}\",\n  \"metadata\": {\n    \"twilio_call_sid\": \"{{ $('Twilio Incoming1').item.json.body.CallSid }}\"\n  }\n}",
        "options": {}
      },
      "id": "96e21dd1-44cc-42ae-bcc4-c6204027caef",
      "name": "Register Call with Retell",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1184,
        784
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "tCjg50tmT5af1WHk",
          "name": "Header Auth account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "twilio_inbound",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "2d653bf2-8a9f-40a0-b384-2e168740d670",
      "name": "Twilio Incoming",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        576,
        1392
      ],
      "webhookId": "twilio_inbound"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1DE40PUBFOaRbQ5j7QvbeUL5uaWZRgF6f0mMmqjMrXBQ",
          "mode": "list",
          "cachedResultName": "callhero_client_controls",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DE40PUBFOaRbQ5j7QvbeUL5uaWZRgF6f0mMmqjMrXBQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "controls",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DE40PUBFOaRbQ5j7QvbeUL5uaWZRgF6f0mMmqjMrXBQ/edit#gid=0"
        },
        "options": {
          "dataLocationOnSheet": {
            "values": {
              "rangeDefinition": "detectAutomatically",
              "readRowsUntil": "firstEmptyRow"
            }
          }
        }
      },
      "id": "425bb195-272d-4d3a-9b53-74f500a37d36",
      "name": "Get All Rows",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        800,
        1392
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "ay6BXf7VXjQLw1Bj",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "filter_by_number",
              "leftValue": "={{ $json.twilio_num }}",
              "rightValue": "={{ $('Twilio Incoming').item.json.body.To }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "27a1f51c-4991-425b-b1ce-8751309453b2",
      "name": "Filter by Twilio Number",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [
        1024,
        1392
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Response>\n  <Dial>{{ $json.client_num }}</Dial>\n</Response>",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/xml"
              }
            ]
          }
        }
      },
      "id": "fb50e53a-59eb-49a3-8adc-01964ed98654",
      "name": "Forward to Client Number",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1456,
        1264
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "check_switch",
              "leftValue": "={{ $json.switch }}",
              "rightValue": "Off",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "e88d8156-b9f3-4daa-86cc-c8743bc6c5d4",
      "name": "Check if Switch is Off",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1248,
        1392
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Response>\n  <Say>This number is currently unavailable.</Say>\n  <Hangup/>\n</Response>",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/xml"
              }
            ]
          }
        }
      },
      "id": "6e3212bf-71fa-4f40-95c9-ee1adca08612",
      "name": "Else Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1456,
        1456
      ]
    }
  ],
  "connections": {
    "Register Call with Retell": {
      "main": [
        []
      ]
    },
    "Twilio Incoming": {
      "main": [
        [
          {
            "node": "Get All Rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Rows": {
      "main": [
        [
          {
            "node": "Filter by Twilio Number",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter by Twilio Number": {
      "main": [
        [
          {
            "node": "Check if Switch is Off",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if Switch is Off": {
      "main": [
        [
          {
            "node": "Forward to Client Number",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Else Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "5d8e1ea7-178d-4d3b-a0a5-8537c6f5a148",
  "triggerCount": 1,
  "shared": [
    {
      "createdAt": "2025-09-22T16:23:27.761Z",
      "updatedAt": "2025-09-22T16:23:27.761Z",
      "role": "workflow:owner",
      "workflowId": "COFXD2kDMMfUSSnT",
      "projectId": "QnZS644IJrqTdTYd",
      "project": {
        "createdAt": "2025-09-20T23:48:52.873Z",
        "updatedAt": "2025-09-20T23:51:48.407Z",
        "id": "QnZS644IJrqTdTYd",
        "name": "Anthony De Caro <anthony@thecallhero.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "createdAt": "2025-09-20T23:48:52.873Z",
            "updatedAt": "2025-09-20T23:48:52.873Z",
            "userId": "77dce4c9-f982-4209-a648-9d170c21af50",
            "projectId": "QnZS644IJrqTdTYd",
            "user": {
              "createdAt": "2025-09-20T23:48:51.147Z",
              "updatedAt": "2025-10-04T13:53:28.872Z",
              "id": "77dce4c9-f982-4209-a648-9d170c21af50",
              "email": "anthony@thecallhero.com",
              "firstName": "Anthony",
              "lastName": "De Caro",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-09-20T23:52:06.003Z",
                "personalization_survey_n8n_version": "1.111.1",
                "companySize": "<20",
                "companyType": "saas",
                "role": "business-owner",
                "reportedSource": "youtube"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "COFXD2kDMMfUSSnT",
                "userActivatedAt": 1758673412990,
                "npsSurvey": {
                  "waitingForResponse": true,
                  "ignoredCount": 1,
                  "lastShownAt": 1759586006120
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2025-10-04",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": []
}